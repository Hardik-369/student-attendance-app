<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Name List Keeper</title>
    
    <!-- Tailwind CSS v3 CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'futuristic': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        /* Custom checkbox styles */
        .attendance-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .attendance-checkbox:checked {
            background: #10b981;
            border-color: #10b981;
        }
        
        .attendance-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            left: 2px;
            top: -2px;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .leave-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .leave-checkbox:checked {
            background: #f59e0b;
            border-color: #f59e0b;
        }
        
        .leave-checkbox:checked::after {
            content: 'L';
            position: absolute;
            left: 4px;
            top: -1px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Status badges */
        .status-present {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status-absent {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .status-leave {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50 text-black font-futuristic">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="w-80 bg-white border-r border-gray-200 flex flex-col shadow-sm md:relative md:translate-x-0">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-gray-900 to-gray-700">
                <h1 class="text-2xl font-bold text-white">Name List Keeper</h1>
                <p class="text-sm text-gray-300 mt-1">Student Attendance Management</p>
            </div>
            
            <!-- Year Navigation -->
            <div class="flex-1 p-6">
                <h2 class="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-4">Academic Years</h2>
                <nav class="space-y-3">
                    <button class="year-btn w-full text-left px-4 py-4 rounded-xl transition-all hover:bg-gray-50 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-100" data-year="first">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-graduation-cap text-blue-600"></i>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-900 block">First Year</span>
                                <span class="text-xs text-gray-500" id="first-year-count">0 students</span>
                            </div>
                        </div>
                    </button>
                    <button class="year-btn w-full text-left px-4 py-4 rounded-xl transition-all hover:bg-gray-50 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-100" data-year="second">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-graduation-cap text-green-600"></i>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-900 block">Second Year</span>
                                <span class="text-xs text-gray-500" id="second-year-count">0 students</span>
                            </div>
                        </div>
                    </button>
                    <button class="year-btn w-full text-left px-4 py-4 rounded-xl transition-all hover:bg-gray-50 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-100" data-year="third">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-graduation-cap text-purple-600"></i>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-900 block">Third Year</span>
                                <span class="text-xs text-gray-500" id="third-year-count">0 students</span>
                            </div>
                        </div>
                    </button>
                    <button class="year-btn w-full text-left px-4 py-4 rounded-xl transition-all hover:bg-gray-50 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300 border border-gray-100" data-year="fourth">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-graduation-cap text-orange-600"></i>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-900 block">Fourth Year</span>
                                <span class="text-xs text-gray-500" id="fourth-year-count">0 students</span>
                            </div>
                        </div>
                    </button>
                </nav>
            </div>
            
            <!-- Sidebar Footer -->
            <div class="p-6 border-t border-gray-200 bg-gray-50">
                <div class="text-center">
                    <div class="text-sm font-medium text-gray-700 mb-1">Today's Date</div>
                    <div class="text-xs text-gray-500" id="current-date"></div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden"></div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <div class="bg-white border-b border-gray-200 p-4 lg:p-6 shadow-sm">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <!-- Mobile Menu Button -->
                        <button id="mobile-menu-btn" class="md:hidden mr-4 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <div>
                            <h2 id="current-year-title" class="text-xl lg:text-3xl font-bold text-gray-900">Select a Year Group</h2>
                            <div class="flex items-center mt-2 space-x-4">
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-users text-gray-500 mr-1"></i>
                                    <span class="text-gray-600"><span id="student-count">0</span> students</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-check-circle text-green-500 mr-1"></i>
                                    <span class="text-gray-600"><span id="present-count">0</span> present</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-times-circle text-red-500 mr-1"></i>
                                    <span class="text-gray-600"><span id="absent-count">0</span> absent</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-calendar-alt text-yellow-500 mr-1"></i>
                                    <span class="text-gray-600"><span id="leave-count">0</span> on leave</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <button id="add-student-btn" class="px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300 flex items-center shadow-sm">
                            <i class="fas fa-plus mr-2"></i>
                            <span class="hidden sm:inline">Add Student</span>
                        </button>
                        <button id="import-csv-btn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300 flex items-center">
                            <i class="fas fa-upload mr-2"></i>
                            <span class="hidden sm:inline">Import CSV</span>
                        </button>
                        <button id="export-csv-btn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300 flex items-center">
                            <i class="fas fa-download mr-2"></i>
                            <span class="hidden sm:inline">Export CSV</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Student List -->
            <div class="flex-1 p-4 lg:p-6 overflow-y-auto custom-scrollbar bg-gray-50">
                <div id="no-year-selected" class="text-center py-20">
                    <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200 max-w-md mx-auto">
                        <i class="fas fa-graduation-cap text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Select a Year Group</h3>
                        <p class="text-gray-600">Choose a year group from the sidebar to manage student attendance</p>
                    </div>
                </div>
                
                <div id="student-list-container" class="hidden">
                    <div id="empty-state" class="text-center py-20">
                        <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200 max-w-md mx-auto">
                            <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">No Students Added</h3>
                            <p class="text-gray-600 mb-6">Start by adding students manually or importing a CSV file</p>
                            <button class="add-student-trigger px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors shadow-sm">
                                <i class="fas fa-plus mr-2"></i>
                                Add First Student
                            </button>
                        </div>
                    </div>
                    
                    <div id="student-table" class="hidden">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                                <h3 class="text-lg font-bold text-gray-900">Student Attendance</h3>
                                <p class="text-sm text-gray-600 mt-1">Mark attendance by checking the appropriate box</p>
                            </div>
                            <div class="divide-y divide-gray-100">
                                <div id="students-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Student Modal -->
    <div id="add-student-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900">Add New Student</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="add-student-form">
                <div class="mb-6">
                    <label for="student-name" class="block text-sm font-semibold text-gray-700 mb-2">Student Name</label>
                    <input type="text" id="student-name" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"
                           placeholder="Enter full name">
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-add" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors shadow-sm">
                        Add Student
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- CSV Import Input -->
    <input type="file" id="csv-file-input" accept=".csv" class="hidden">
    
    <script>
        class NameListKeeper {
            constructor() {
                this.currentYear = null;
                this.students = {};
                this.lastResetDate = this.getStoredLastResetDate();
                
                this.init();
                this.checkDailyReset();
                this.updateCurrentDate();
            }
            
            init() {
                this.loadAllData();
                this.bindEvents();
                this.updateMobileLayout();
                this.updateSidebarCounts();
                window.addEventListener('resize', () => this.updateMobileLayout());
            }
            
            bindEvents() {
                // Year navigation
                document.querySelectorAll('.year-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const year = e.currentTarget.dataset.year;
                        this.selectYear(year);
                    });
                });
                
                // Top bar buttons
                document.getElementById('add-student-btn').addEventListener('click', () => this.showAddStudentModal());
                document.getElementById('import-csv-btn').addEventListener('click', () => this.importCSV());
                document.getElementById('export-csv-btn').addEventListener('click', () => this.exportCSV());
                
                // Modal controls
                document.getElementById('close-modal').addEventListener('click', () => this.hideAddStudentModal());
                document.getElementById('cancel-add').addEventListener('click', () => this.hideAddStudentModal());
                document.getElementById('add-student-form').addEventListener('submit', (e) => this.addStudent(e));
                
                // Add student triggers
                document.querySelectorAll('.add-student-trigger').forEach(btn => {
                    btn.addEventListener('click', () => this.showAddStudentModal());
                });
                
                // CSV file input
                document.getElementById('csv-file-input').addEventListener('change', (e) => this.handleCSVImport(e));
                
                // Mobile menu
                document.getElementById('mobile-menu-btn').addEventListener('click', () => this.toggleMobileSidebar());
                document.getElementById('sidebar-overlay').addEventListener('click', () => this.closeMobileSidebar());
                
                // ESC key handling
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideAddStudentModal();
                        this.closeMobileSidebar();
                    }
                });
            }
            
            generateUniqueId() {
                return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            loadAllData() {
                const years = ['first', 'second', 'third', 'fourth'];
                years.forEach(year => {
                    const data = localStorage.getItem(`students_${year}`);
                    if (data) {
                        this.students[year] = JSON.parse(data);
                        // Migrate existing data to include unique IDs if needed
                        this.migrateStudentData(year);
                    } else {
                        this.students[year] = [];
                    }
                });
            }
            
            migrateStudentData(year) {
                let needsMigration = false;
                this.students[year] = this.students[year].map(student => {
                    if (!student.id) {
                        needsMigration = true;
                        return {
                            id: this.generateUniqueId(),
                            name: student.name || student,
                            status: 'absent' // Default to absent
                        };
                    }
                    // Migrate old boolean present field to new status field
                    if (student.present !== undefined && !student.status) {
                        needsMigration = true;
                        student.status = student.present ? 'present' : 'absent';
                        delete student.present;
                    }
                    // Ensure all students have a status field
                    if (!student.status) {
                        needsMigration = true;
                        student.status = 'absent';
                    }
                    return student;
                });
                
                if (needsMigration) {
                    this.saveStudentData(year);
                }
            }
            
            saveStudentData(year) {
                localStorage.setItem(`students_${year}`, JSON.stringify(this.students[year]));
            }
            
            selectYear(year) {
                this.currentYear = year;
                
                // Update active state
                document.querySelectorAll('.year-btn').forEach(btn => {
                    btn.classList.remove('bg-gray-900', 'text-white', 'shadow-sm');
                    btn.classList.add('hover:bg-gray-50');
                });
                
                const activeBtn = document.querySelector(`[data-year="${year}"]`);
                activeBtn.classList.add('bg-gray-900', 'text-white', 'shadow-sm');
                activeBtn.classList.remove('hover:bg-gray-50');
                
                // Update title
                const yearNames = {
                    'first': 'First Year Students',
                    'second': 'Second Year Students', 
                    'third': 'Third Year Students',
                    'fourth': 'Fourth Year Students'
                };
                
                document.getElementById('current-year-title').textContent = yearNames[year];
                
                // Show/hide appropriate content
                document.getElementById('no-year-selected').classList.add('hidden');
                document.getElementById('student-list-container').classList.remove('hidden');
                
                this.renderStudentList();
                this.updateStats();
                this.closeMobileSidebar();
            }
            
            updateSidebarCounts() {
                const years = ['first', 'second', 'third', 'fourth'];
                years.forEach(year => {
                    const students = this.students[year] || [];
                    const count = students.length;
                    document.getElementById(`${year}-year-count`).textContent = `${count} student${count !== 1 ? 's' : ''}`;
                });
            }
            
            renderStudentList() {
                if (!this.currentYear) return;
                
                const students = this.students[this.currentYear] || [];
                const container = document.getElementById('students-container');
                const emptyState = document.getElementById('empty-state');
                const studentTable = document.getElementById('student-table');
                
                if (students.length === 0) {
                    emptyState.classList.remove('hidden');
                    studentTable.classList.add('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                studentTable.classList.remove('hidden');
                
                container.innerHTML = students.map(student => {
                    const status = student.status || 'absent';
                    const statusText = status === 'present' ? 'Present' : status === 'leave' ? 'On Leave' : 'Absent';
                    const statusClass = status === 'present' ? 'status-present' : status === 'leave' ? 'status-leave' : 'status-absent';
                    
                    return `
                        <div class="px-6 py-5 flex items-center justify-between hover:bg-gray-50 transition-colors">
                            <div class="flex items-center flex-1">
                                <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-user text-gray-600"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-900">${student.name}</h4>
                                    <div class="flex items-center mt-1">
                                        <p class="text-sm text-gray-500 mr-3">ID: ${student.id.split('_')[0]}</p>
                                        <span class="px-2 py-1 text-xs font-medium rounded-full ${statusClass}">
                                            ${statusText}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-6">
                                <div class="flex items-center space-x-4">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="attendance-checkbox" 
                                               ${status === 'present' ? 'checked' : ''}
                                               onchange="app.setAttendanceStatus('${student.id}', 'present', this.checked)">
                                        <span class="text-sm font-medium text-gray-700">Present</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="leave-checkbox" 
                                               ${status === 'leave' ? 'checked' : ''}
                                               onchange="app.setAttendanceStatus('${student.id}', 'leave', this.checked)">
                                        <span class="text-sm font-medium text-gray-700">Leave</span>
                                    </label>
                                </div>
                                <button onclick="app.removeStudent('${student.id}')" 
                                        class="text-gray-400 hover:text-red-600 transition-colors p-2 rounded-lg hover:bg-red-50">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            setAttendanceStatus(studentId, type, checked) {
                if (!this.currentYear) return;
                
                const student = this.students[this.currentYear].find(s => s.id === studentId);
                if (student) {
                    if (checked) {
                        student.status = type; // 'present' or 'leave'
                    } else {
                        student.status = 'absent'; // Default when unchecked
                    }
                    
                    this.saveStudentData(this.currentYear);
                    this.renderStudentList();
                    this.updateStats();
                }
            }
            
            removeStudent(studentId) {
                if (!this.currentYear) return;
                
                if (confirm('Are you sure you want to remove this student?')) {
                    this.students[this.currentYear] = this.students[this.currentYear].filter(s => s.id !== studentId);
                    this.saveStudentData(this.currentYear);
                    this.renderStudentList();
                    this.updateStats();
                    this.updateSidebarCounts();
                }
            }
            
            updateStats() {
                if (!this.currentYear) return;
                
                const students = this.students[this.currentYear] || [];
                const total = students.length;
                const present = students.filter(s => s.status === 'present').length;
                const leave = students.filter(s => s.status === 'leave').length;
                const absent = total - present - leave;
                
                document.getElementById('student-count').textContent = total;
                document.getElementById('present-count').textContent = present;
                document.getElementById('absent-count').textContent = absent;
                document.getElementById('leave-count').textContent = leave;
            }
            
            showAddStudentModal() {
                if (!this.currentYear) {
                    alert('Please select a year group first.');
                    return;
                }
                
                document.getElementById('add-student-modal').classList.remove('hidden');
                document.getElementById('student-name').focus();
            }
            
            hideAddStudentModal() {
                document.getElementById('add-student-modal').classList.add('hidden');
                document.getElementById('add-student-form').reset();
            }
            
            addStudent(e) {
                e.preventDefault();
                
                if (!this.currentYear) return;
                
                const name = document.getElementById('student-name').value.trim();
                if (!name) return;
                
                // Check for duplicate names
                const exists = this.students[this.currentYear].some(s => 
                    s.name.toLowerCase() === name.toLowerCase()
                );
                
                if (exists) {
                    alert('A student with this name already exists.');
                    return;
                }
                
                const newStudent = {
                    id: this.generateUniqueId(),
                    name: name,
                    status: 'absent' // Default to absent
                };
                
                this.students[this.currentYear].push(newStudent);
                this.saveStudentData(this.currentYear);
                this.renderStudentList();
                this.updateStats();
                this.updateSidebarCounts();
                this.hideAddStudentModal();
            }
            
            importCSV() {
                if (!this.currentYear) {
                    alert('Please select a year group first.');
                    return;
                }
                
                document.getElementById('csv-file-input').click();
            }
            
            handleCSVImport(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const csv = event.target.result;
                    const lines = csv.split('\n').filter(line => line.trim());
                    
                    let imported = 0;
                    let skipped = 0;
                    
                    lines.forEach((line, index) => {
                        const name = line.split(',')[0].trim().replace(/"/g, '');
                        
                        if (name && name.toLowerCase() !== 'name') {
                            // Check for duplicates
                            const exists = this.students[this.currentYear].some(s => 
                                s.name.toLowerCase() === name.toLowerCase()
                            );
                            
                            if (!exists) {
                                this.students[this.currentYear].push({
                                    id: this.generateUniqueId(),
                                    name: name,
                                    status: 'absent' // Default to absent
                                });
                                imported++;
                            } else {
                                skipped++;
                            }
                        }
                    });
                    
                    this.saveStudentData(this.currentYear);
                    this.renderStudentList();
                    this.updateStats();
                    this.updateSidebarCounts();
                    
                    alert(`Import complete!\nImported: ${imported} students\nSkipped (duplicates): ${skipped} students`);
                };
                
                reader.readAsText(file);
                e.target.value = ''; // Reset file input
            }
            
            exportCSV() {
                if (!this.currentYear) {
                    alert('Please select a year group first.');
                    return;
                }
                
                const students = this.students[this.currentYear] || [];
                if (students.length === 0) {
                    alert('No students to export.');
                    return;
                }
                
                const yearNames = {
                    'first': 'First_Year',
                    'second': 'Second_Year',
                    'third': 'Third_Year',
                    'fourth': 'Fourth_Year'
                };
                
                const headers = ['Name', 'Status', 'Student_ID'];
                const csvContent = [
                    headers.join(','),
                    ...students.map(student => {
                        const status = student.status || 'absent';
                        const statusText = status === 'present' ? 'Present' : status === 'leave' ? 'Leave' : 'Absent';
                        return [
                            `"${student.name}"`,
                            statusText,
                            student.id
                        ].join(',');
                    })
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${yearNames[this.currentYear]}_Attendance_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }
            
            checkDailyReset() {
                const today = new Date().toDateString();
                
                if (this.lastResetDate !== today) {
                    // Reset all attendance for all years
                    Object.keys(this.students).forEach(year => {
                        this.students[year].forEach(student => {
                            student.status = 'absent'; // Reset to absent
                        });
                        this.saveStudentData(year);
                    });
                    
                    localStorage.setItem('lastResetDate', today);
                    this.lastResetDate = today;
                }
            }
            
            getStoredLastResetDate() {
                return localStorage.getItem('lastResetDate') || '';
            }
            
            updateCurrentDate() {
                const today = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', options);
            }
            
            updateMobileLayout() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                if (window.innerWidth < 768) { // md breakpoint
                    sidebar.classList.add('fixed', 'left-0', 'top-0', 'h-full', 'z-30', '-translate-x-full');
                    sidebar.classList.remove('relative');
                } else {
                    sidebar.classList.remove('fixed', 'left-0', 'top-0', 'h-full', 'z-30', '-translate-x-full', 'translate-x-0');
                    sidebar.classList.add('relative');
                    overlay.classList.add('hidden');
                }
            }
            
            toggleMobileSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                if (sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                    overlay.classList.remove('hidden');
                } else {
                    this.closeMobileSidebar();
                }
            }
            
            closeMobileSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                sidebar.classList.add('-translate-x-full');
                sidebar.classList.remove('translate-x-0');
                overlay.classList.add('hidden');
            }
        }
        
        // Initialize the application
        const app = new NameListKeeper();
    </script>
</body>
</html>
